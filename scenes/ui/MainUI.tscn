[gd_scene load_steps=21 format=3 uid="uid://djoolf474qo2p"]

[ext_resource type="Script" uid="uid://bj1vha74m6rd2" path="res://scripts/ui/main_ui.gd" id="1_7s5y6"]
[ext_resource type="Texture2D" uid="uid://vj2xvbhnt45o" path="res://assets/ui/panels/health_bar.png" id="1_kdubu"]
[ext_resource type="Script" uid="uid://csc4qnp65a8rl" path="res://scripts/ui/items.gd" id="3_jv1lx"]
[ext_resource type="Texture2D" uid="uid://cj8i62eqo1cv0" path="res://assets/sprites/items/gems/GemIcon.png" id="3_rj586"]
[ext_resource type="Texture2D" uid="uid://bldlesja38ka7" path="res://assets/sprites/items/key/key_1.png" id="4_4d7sh"]
[ext_resource type="FontFile" uid="uid://bf742t4mxgd7l" path="res://assets/fonts/big_font.fnt" id="4_qg6rx"]
[ext_resource type="Texture2D" uid="uid://dtwnvoh5jfgsn" path="res://assets/sprites/items/coin/01.png" id="5_ir8iy"]
[ext_resource type="Texture2D" uid="uid://bak1dc8urb02c" path="res://assets/ui/buttons/settings_button.png" id="6_hqns4"]
[ext_resource type="Texture2D" uid="uid://cf2xtiybswiem" path="res://assets/sprites/items/Keyboard/A.png" id="7_ir8iy"]
[ext_resource type="Texture2D" uid="uid://ci25u8dfvvsna" path="res://assets/sprites/items/Keyboard/Space.png" id="8_hqns4"]
[ext_resource type="Texture2D" uid="uid://d0s8rm2fj4wef" path="res://assets/sprites/characters/foxy/blade/blade_anim_1.png" id="8_rpv8g"]
[ext_resource type="Texture2D" uid="uid://btl01pl2rrre3" path="res://assets/ui/icons/copper.png" id="9_k3ty2"]
[ext_resource type="Texture2D" uid="uid://d086j8jvm50hp" path="res://assets/sprites/items/Keyboard/D.png" id="9_x0ka3"]
[ext_resource type="Texture2D" uid="uid://ddbid6rke16wu" path="res://assets/ui/icons/iron.png" id="10_dg873"]
[ext_resource type="Texture2D" uid="uid://d2ac5s0c14wb6" path="res://assets/ui/icons/gold.png" id="11_bgwmq"]
[ext_resource type="Texture2D" uid="uid://dos6hwpl7kq7l" path="res://assets/ui/panels/progress.png" id="12_mjmcw"]
[ext_resource type="PackedScene" uid="uid://bquisodmhmkdk" path="res://scenes/ui/inventory/Inv_ui.tscn" id="14_jv1lx"]
[ext_resource type="Script" uid="uid://c2xtf1ss4k7gw" path="res://scripts/ui/texture_progress_bar.gd" id="14_rpv8g"]
[ext_resource type="PackedScene" uid="uid://ibceon5tf4v2" path="res://scenes/ui/inventory/AllInventory.tscn" id="19_dg873"]

[sub_resource type="GDScript" id="GDScript_k3ty2"]
script/source = "extends PanelContainer

@onready var weapon_name_label: Label = $MarginContainer/VBoxContainer/WeaponName
@onready var damage_label: Label = $MarginContainer/VBoxContainer/Damage
@onready var hp_bonus_label: Label = $MarginContainer/VBoxContainer/HPBonus
@onready var atk_speed_label: Label = $MarginContainer/VBoxContainer/AttackSpeedBonus
@onready var special_ability_label: Label = $MarginContainer/VBoxContainer/SpecialAbility

# Tùy chỉnh chiều rộng tối đa của bảng thông tin tại đây (tính bằng pixel)
const MAX_PANEL_WIDTH = 250.0 

func _ready() -> void:
	# Đảm bảo đường dẫn tới item_storer là đúng
	GameManager.player.inventory.item_storer.info_panel_change.connect(_update_info_panel)
	visible = false
	
	# --- SETUP TỰ ĐỘNG XUỐNG DÒNG ---
	# Áp dụng cho label Skill (thường là cái dài nhất)
	special_ability_label.autowrap_mode = TextServer.AUTOWRAP_WORD_SMART
	special_ability_label.custom_minimum_size.x = MAX_PANEL_WIDTH
	
	# Nếu tên vũ khí cũng dài, bạn có thể bật luôn cho nó:
	# weapon_name_label.autowrap_mode = TextServer.AUTOWRAP_WORD_SMART
	# weapon_name_label.custom_minimum_size.x = MAX_PANEL_WIDTH

func _update_info_panel(weapon_data: WeaponData):
	if weapon_data == null:
		visible = false
		return
	
	visible = true
	
	# weapon_name_label.text = weapon_data.resource_name.capitalize() 
	
	var dmg = weapon_data.get_damage()
	if dmg > 0:
		damage_label.text = \"⚔ Damage: %d\" % dmg
		damage_label.visible = true
	else:
		damage_label.visible = false

	var hp = weapon_data.get_max_health()
	if hp > 0:
		hp_bonus_label.text = \"♥ Health: +%d\" % hp
		hp_bonus_label.visible = true
	else:
		hp_bonus_label.visible = false
	
	var spd = weapon_data.get_attack_speed()
	atk_speed_label.text = \"⚡ Speed: %.1f\" % spd
	
	var skill = weapon_data.get_special_skill()
	if skill != \"\":
		special_ability_label.text = \"★ Skill: %s\" % skill.capitalize()
		special_ability_label.visible = true
		special_ability_label.modulate = Color.GOLD 
	else:
		special_ability_label.visible = false
"

[node name="MainUI" type="CanvasLayer"]
script = ExtResource("1_7s5y6")

[node name="InvUi" parent="." instance=ExtResource("14_jv1lx")]
anchors_preset = 7
anchor_left = 0.5
anchor_top = 1.0
anchor_right = 0.5
offset_top = -77.0
offset_bottom = -77.0
grow_vertical = 0

[node name="Camera2D" type="Camera2D" parent="."]
position = Vector2(240, 136)

[node name="Items" type="VBoxContainer" parent="."]
offset_left = 19.0
offset_top = 71.0
offset_right = 111.0
offset_bottom = 183.0
scale = Vector2(0.5, 0.5)
script = ExtResource("3_jv1lx")

[node name="1" type="HBoxContainer" parent="Items"]
visible = false
custom_minimum_size = Vector2(0, 60)
layout_mode = 2
size_flags_horizontal = 4

[node name="GemIcon" type="TextureRect" parent="Items/1"]
layout_mode = 2
texture = ExtResource("3_rj586")
expand_mode = 2

[node name="NumGems" type="Label" parent="Items/1"]
layout_mode = 2
theme_override_fonts/font = ExtResource("4_qg6rx")
theme_override_font_sizes/font_size = 30
text = "0"
vertical_alignment = 1

[node name="2" type="HBoxContainer" parent="Items"]
custom_minimum_size = Vector2(0, 60)
layout_mode = 2
size_flags_horizontal = 4

[node name="Key" type="TextureRect" parent="Items/2"]
layout_mode = 2
texture = ExtResource("4_4d7sh")
expand_mode = 2

[node name="NumKey" type="Label" parent="Items/2"]
layout_mode = 2
theme_override_fonts/font = ExtResource("4_qg6rx")
theme_override_font_sizes/font_size = 30
text = "0"
vertical_alignment = 1

[node name="3" type="HBoxContainer" parent="Items"]
custom_minimum_size = Vector2(0, 60)
layout_mode = 2
size_flags_horizontal = 4

[node name="Coin" type="TextureRect" parent="Items/3"]
layout_mode = 2
texture = ExtResource("5_ir8iy")
expand_mode = 2

[node name="NumCoin" type="Label" parent="Items/3"]
layout_mode = 2
theme_override_fonts/font = ExtResource("4_qg6rx")
theme_override_font_sizes/font_size = 30
text = "0"
vertical_alignment = 1

[node name="4" type="HBoxContainer" parent="Items"]
custom_minimum_size = Vector2(0, 60)
layout_mode = 2
size_flags_horizontal = 4

[node name="Blade" type="TextureRect" parent="Items/4"]
layout_mode = 2
texture = ExtResource("8_rpv8g")
expand_mode = 2

[node name="NumBlade" type="Label" parent="Items/4"]
layout_mode = 2
theme_override_fonts/font = ExtResource("4_qg6rx")
theme_override_font_sizes/font_size = 30
text = "0"
vertical_alignment = 1

[node name="5" type="HBoxContainer" parent="Items"]
custom_minimum_size = Vector2(0, 60)
layout_mode = 2
size_flags_horizontal = 4

[node name="Copper" type="TextureRect" parent="Items/5"]
layout_mode = 2
texture = ExtResource("9_k3ty2")
expand_mode = 2

[node name="NumCopper" type="Label" parent="Items/5"]
layout_mode = 2
theme_override_fonts/font = ExtResource("4_qg6rx")
theme_override_font_sizes/font_size = 30
text = "0"
vertical_alignment = 1

[node name="6" type="HBoxContainer" parent="Items"]
custom_minimum_size = Vector2(0, 60)
layout_mode = 2
size_flags_horizontal = 4

[node name="Iron" type="TextureRect" parent="Items/6"]
layout_mode = 2
texture = ExtResource("10_dg873")
expand_mode = 2

[node name="NumIron" type="Label" parent="Items/6"]
layout_mode = 2
theme_override_fonts/font = ExtResource("4_qg6rx")
theme_override_font_sizes/font_size = 30
text = "0"
vertical_alignment = 1

[node name="7" type="HBoxContainer" parent="Items"]
custom_minimum_size = Vector2(0, 60)
layout_mode = 2
size_flags_horizontal = 4

[node name="Gold" type="TextureRect" parent="Items/7"]
layout_mode = 2
texture = ExtResource("11_bgwmq")
expand_mode = 2

[node name="NumGold" type="Label" parent="Items/7"]
layout_mode = 2
theme_override_fonts/font = ExtResource("4_qg6rx")
theme_override_font_sizes/font_size = 30
text = "0"
vertical_alignment = 1

[node name="ASD" type="HBoxContainer" parent="."]
visible = false
offset_left = 29.0
offset_top = 222.0
offset_right = 350.0
offset_bottom = 326.0
scale = Vector2(0.25, 0.25)
theme_override_constants/separation = 0
alignment = 1

[node name="A" type="TextureRect" parent="ASD"]
layout_mode = 2
texture = ExtResource("7_ir8iy")
expand_mode = 2

[node name="Space" type="TextureRect" parent="ASD"]
layout_mode = 2
texture = ExtResource("8_hqns4")
expand_mode = 2

[node name="D" type="TextureRect" parent="ASD"]
layout_mode = 2
texture = ExtResource("9_x0ka3")
expand_mode = 3

[node name="SettingsButton" type="Button" parent="."]
anchors_preset = 1
anchor_left = 1.0
anchor_right = 1.0
offset_left = -80.0
offset_bottom = 80.0
grow_horizontal = 0
icon = ExtResource("6_hqns4")
flat = true
icon_alignment = 2
expand_icon = true

[node name="HealthBar" type="TextureProgressBar" parent="."]
offset_left = 11.0
offset_top = 11.0
offset_right = 107.0
offset_bottom = 43.0
scale = Vector2(2, 2)
value = 40.0
texture_under = ExtResource("1_kdubu")
texture_progress = ExtResource("12_mjmcw")
texture_progress_offset = Vector2(18, 10)
script = ExtResource("14_rpv8g")

[node name="InfoUI" type="PanelContainer" parent="."]
anchors_preset = 2
anchor_top = 1.0
anchor_bottom = 1.0
offset_left = 30.0
offset_top = -205.0
offset_right = 244.0
offset_bottom = -29.0
grow_vertical = 0
script = SubResource("GDScript_k3ty2")

[node name="MarginContainer" type="MarginContainer" parent="InfoUI"]
layout_mode = 2

[node name="VBoxContainer" type="VBoxContainer" parent="InfoUI/MarginContainer"]
layout_mode = 2
alignment = 2

[node name="WeaponName" type="Label" parent="InfoUI/MarginContainer/VBoxContainer"]
layout_mode = 2
theme_override_font_sizes/font_size = 23
text = "Weapon Name"

[node name="Damage" type="Label" parent="InfoUI/MarginContainer/VBoxContainer"]
layout_mode = 2
theme_override_font_sizes/font_size = 23
text = "Damage:"

[node name="HPBonus" type="Label" parent="InfoUI/MarginContainer/VBoxContainer"]
layout_mode = 2
theme_override_font_sizes/font_size = 23
text = "HP:"

[node name="AttackSpeedBonus" type="Label" parent="InfoUI/MarginContainer/VBoxContainer"]
layout_mode = 2
theme_override_font_sizes/font_size = 23
text = "Attack Speed:"

[node name="SpecialAbility" type="Label" parent="InfoUI/MarginContainer/VBoxContainer"]
layout_mode = 2
theme_override_font_sizes/font_size = 23
text = "Special Ability:"

[node name="AllInventory" parent="." instance=ExtResource("19_dg873")]
anchors_preset = 8
anchor_left = 0.5
anchor_top = 0.5
anchor_right = 0.5
anchor_bottom = 0.5
grow_horizontal = 2
grow_vertical = 2
